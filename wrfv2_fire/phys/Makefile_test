#FC = ifort -fast/

FC = ifort -g -debug all -traceback -ftrapuv -inline-debug-info -check all -stand f95 -free
#FC = g95 -ftrace=frame -g -ffree-form

.SUFFIXES:
.SUFFIXES: .F .o

.F.o: 
	$(FC) -c $*.F

# module dependencies

module_fr_sfire_model.o: \
     module_fr_sfire_core.o  \
     module_fr_cawfe_fuel.o \
     module_fr_sfire_util.o 

module_fr_sfire_core.o: \
     module_fr_sfire_prop.o \
     module_fr_sfire_burn.o \
     module_fr_sfire_util.o 
      
module_fr_sfire_burn.o: \
     module_fr_sfire_util.o \
     module_fr_sfire_prop.o 
      
module_fr_sfire_prop.o: \
     module_fr_sfire_util.o 

module_fr_sfire_util.o: \
     wrf_fakes.o

# test binaries and targers

# the propagation alone 
PROP_OBJ = \
     module_fr_sfire_prop.o \
     module_fr_sfire_util.o \
     wrf_fakes.o 

prop_test.exe: $(PROP_OBJ) prop_test.F
	$(FC) -o prop_test.exe $(PROP_OBJ) prop_test.F

prop_test: prop_test.exe
	# run prop_driver from matlab to test

# burn balance
FUEL_TEST_OBJ=\
    module_fr_sfire_burn.o \
    module_fr_sfire_util.o \
    wrf_fakes.o \
    burn_test.F

burn_test.exe: $(FUEL_TEST_OBJ)
	$(FC) -o burn_test.exe $(FUEL_TEST_OBJ)

burn_test: burn_test.exe
	./burn_test.exe

# utilities
UTIL_OBJ= \
    util_test.F   \
    module_fr_sfire_util.o  \
    wrf_fakes.o

util_test.exe: $(UTIL_OBJ)
	$(FC) -o util_test.exe $(UTIL_OBJ)

util_test: util_test.exe
	./util_test.exe

LEVEL_OBJ=\
    module_fr_level.o \
    module_fr_sfire_util.o  \
    level_test.F

level_test.exe: $(LEVEL_OBJ)
	$(FC) -o level_test.exe $(LEVEL_OBJ)

level_test: level_test.exe
	./level_test.exe

# widfire model code

# all object files with the model
CORE_OBJ= \
    module_fr_sfire_core.o \
    module_fr_sfire_prop.o \
    module_fr_sfire_burn.o \
    module_fr_sfire_util.o  \
    wrf_fakes.o

core_test.exe: $(CORE_OBJ)
	$(FC) -o core_test.exe core_test.F $(CORE_OBJ)

core_test: core_test.exe
	# run core_test in Matlab

# the whole model
MODEL_OBJ = \
    module_fr_sfire_model.o \
    module_fr_cawfe_fuel.o \
    module_fr_sfire_core.o \
    module_fr_sfire_prop.o \
    module_fr_sfire_burn.o \
    module_fr_sfire_util.o  \
    module_wrf_fakes.o

model_test: $(MODEL_OBJ) 
	$(FC) -o model_test.exe model_test.F $(MODEL_OBJ)

clean:
	rm *.{exe,o,mod}

