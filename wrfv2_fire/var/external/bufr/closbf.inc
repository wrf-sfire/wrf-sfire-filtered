      SUBROUTINE CLOSBF(LUNIT)

!$$$  SUBPROGRAM DOCUMENTATION BLOCK
!
! SUBPROGRAM:    CLOSBF
!   PRGMMR: WOOLLEN          ORG: NP20       DATE: 1994-01-06
!
! ABSTRACT: THIS SUBROUTINE IS CALLED IN ORDER TO TERMINATE BUFR
!   ARCHIVE LIBRARY SOFTWARE ACCESS TO A LOGICAL UNIT LUNIT FOR INPUT
!   OR OUTPUT OPERATIONS (PREVIOUSLY OPENED BY A FORTRAN "OPEN" ON THE
!   LOGICAL UNIT AND BY BUFR ARCHIVE LIBRARY SUBROUTINE OPENBF).
!   CLOSBF MUST BE CALLED WHEN LUNIT IS CONNECTED TO A BUFR FILE OPEN
!   FOR OUTPUT IN ORDER TO PROPERLY CLOSE AND WRITE ANY CURRENT BUFR
!   MESSAGE WHICH MAY STILL EXIST IN INTERNAL MEMORY (AND MOST LIKELY
!   NOT BE FULL).  IT IS NOT MANDATORY THAT CLOSBF BE CALLED WHEN LUNIT
!   IS CONNECTED TO A BUFR FILE OPEN FOR INPUT, BUT IT IS STILL A GOOD
!   IDEA TO DO SO.
!
! PROGRAM HISTORY LOG:
! 1994-01-06  J. WOOLLEN -- ORIGINAL AUTHOR
! 2003-11-04  J. ATOR    -- DON'T CLOSE LUNIT IF OPENED AS A NULL FILE
!                           BY OPENBF {NULL(LUN) = 1 IN NEW COMMON
!                           BLOCK /NULBFR/} (WAS IN DECODER VERSION)
! 2003-11-04  S. BENDER  -- ADDED REMARKS/BUFRLIB ROUTINE
!                           INTERDEPENDENCIES
! 2003-11-04  D. KEYSER  -- UNIFIED/PORTABLE FOR WRF; ADDED
!                           DOCUMENTATION (INCLUDING HISTORY)
!
! USAGE:    CALL CLOSBF (LUNIT)
!   INPUT ARGUMENT LIST:
!     LUNIT    - INTEGER: FORTRAN LOGICAL UNIT NUMBER FOR BUFR FILE
!
!   INPUT FILES:
!     UNIT "LUNIT"  - BUFR FILE
!
!   OUTPUT FILES:
!     UNIT "LUNIT"  - BUFR FILE
!
! REMARKS:
!    THIS ROUTINE CALLS:        CLOSMG   STATUS   WTSTAT
!    THIS ROUTINE IS CALLED BY: UFBINX   UFBMEM   UFBTAB
!                               Also called by application programs.
!
! ATTRIBUTES:
!   LANGUAGE: FORTRAN 77
!   MACHINE:  PORTABLE TO ALL PLATFORMS
!
!$$$

      INCLUDE 'bufrlib.prm'

      COMMON /NULBFR/ NULL(NFILES)

      IF ( ALLOCATED (MSGP) ) DEALLOCATE (MSGP)
      IF ( ALLOCATED (MSGS) ) DEALLOCATE (MSGS)

      IF ( ALLOCATED (MATX_S) ) DEALLOCATE (MATX_S)
      IF ( ALLOCATED (CATX_S) ) DEALLOCATE (CATX_S)
      IF ( ALLOCATED (KMIN_S) ) DEALLOCATE (KMIN_S)
      IF ( ALLOCATED (KMAX_S) ) DEALLOCATE (KMAX_S)
      IF ( ALLOCATED (KMIS_S) ) DEALLOCATE (KMIS_S)
      IF ( ALLOCATED (KBIT_S) ) DEALLOCATE (KBIT_S)
      IF ( ALLOCATED (ITYP_S) ) DEALLOCATE (ITYP_S)
      IF ( ALLOCATED (IWID_S) ) DEALLOCATE (IWID_S)
      IF ( ALLOCATED (CSTR_S) ) DEALLOCATE (CSTR_S)

      IF ( ALLOCATED (TAG) ) DEALLOCATE ( TAG )
      IF ( ALLOCATED (TYP) ) DEALLOCATE ( TYP )
      IF ( ALLOCATED (KNT) ) DEALLOCATE ( KNT )
      IF ( ALLOCATED (JUMP) ) DEALLOCATE ( JUMP )
      IF ( ALLOCATED (LINK) ) DEALLOCATE ( LINK )
      IF ( ALLOCATED (JMPB) ) DEALLOCATE ( JMPB )
      IF ( ALLOCATED (IBT) ) DEALLOCATE ( IBT )
      IF ( ALLOCATED (IRF) ) DEALLOCATE ( IRF )
      IF ( ALLOCATED (ISC) ) DEALLOCATE ( ISC )
      IF ( ALLOCATED (ITP) ) DEALLOCATE ( ITP )
      IF ( ALLOCATED (VALI) ) DEALLOCATE ( VALI )
      IF ( ALLOCATED (KNTI) ) DEALLOCATE ( KNTI )
      IF ( ALLOCATED (ISEQ) ) DEALLOCATE ( ISEQ )
      IF ( ALLOCATED (JSEQ) ) DEALLOCATE ( JSEQ )

      IF ( ALLOCATED (NVAL) ) DEALLOCATE ( NVAL )
      IF ( ALLOCATED (INV) ) DEALLOCATE ( INV )
      IF ( ALLOCATED (VAL) ) DEALLOCATE ( VAL )

      IF ( ALLOCATED (ITMP) ) DEALLOCATE (ITMP)
      IF ( ALLOCATED (VTMP) ) DEALLOCATE (VTMP) 

      CALL STATUS(LUNIT,LUN,IL,IM)
      IF(IL.GT.0 .AND. IM.NE.0) CALL CLOSMG(LUNIT)
      CALL WTSTAT(LUNIT,LUN,0,0)

!  CLOSE LUNIT IF NULL(LUN) = 0
!  ----------------------------

      IF(NULL(LUN).EQ.0) CLOSE(LUNIT)

      RETURN
      END SUBROUTINE CLOSBF
